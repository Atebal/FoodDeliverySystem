<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang=""> <!--<![endif]-->
{% load static %}

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Classic Canteen</title>
    <meta name="description" content="Ela Admin - HTML5 Admin Template">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Canteen</title>
    <link rel="icon" sizes="192x192"
        href="{%static 'Images/classytitle.jpeg' %}">

            
    <link rel="stylesheet" href="{% static 'css/rmessagestyle.css' %}" type="text/css" />  
   
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css">
    <link rel="stylesheet" href="{% static 'css/apachecharts.css' %}" type="text/css" /> 
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lykmapipo/themify-icons@0.1.2/css/themify-icons.css">
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/pixeden-stroke-7-icon@1.2.3/pe-icon-7-stroke/dist/pe-icon-7-stroke.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.0/css/flag-icon.min.css">
    
    
    <link rel="stylesheet" href="{% static 'css/cs-skin-elastic.css' %}">
    <link rel="stylesheet" href="{% static 'css/adminpanel.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'css/dataTables.bootstrap.min.css' %}">
    <link type="text/css" href="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.12/css/dataTables.checkboxes.css" rel="stylesheet" />
    <link rel="stylesheet" href="{% static 'css/adminpanel.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'css/cs-skin-elastic.css' %}" type="text/css" />
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/html5shiv/3.7.3/html5shiv.min.js"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/chartist@0.11.0/dist/chartist.min.css" rel="stylesheet">
   <!-- <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script> -->
       
</head>

<body>
    <!-- Left Panel -->
    <aside id="left-panel" class="left-panel">
        <nav class="navbar navbar-expand-sm navbar-default">
            <div id="main-menu" class="main-menu collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active">
                        <a href="#"><i class="menu-icon fa fa-laptop"></i>Dashboard </a>
                    </li>
                    <li class="menu-title">User Management</li><!-- /.menu-title -->
                    <li class="menu-item-has-children dropdown">
                        <a onclick=displayuser()   class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false"> <i class="menu-icon fa fa-cogs"></i>Users</a>
                       
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a onclick="getroles()" class= "dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false"> <i class="menu-icon fa fa-table"></i> User Roles</a>
                    </li>
                    <li class="menu-item-has-children dropdown">
                        <a onclick=payment() class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false"> <i class="menu-icon fa fa-th"></i>Payments</a>
                      
                    </li>
                    <li class="menu-item-has-children dropdown">
                      <a href="/register/"   aria-haspopup="true"
                          aria-expanded="false"><i class="menu-icon fa fa-th"></i>Add User</a>
                    
                  </li>

                    <li class="menu-title">Items Management</li><!-- /.menu-title -->

                    <li class="menu-item-has-children dropdown">
                        <a onclick="createwhatstoday()" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false"> <i class="menu-icon fa fa-tasks"></i> Create Today's list</a>
                       
                    </li>
                    <li>
                      <a onclick="whatstodaylist()"> <i class="menu-icon ti-email"></i>what's Today </a>
                  </li>
                    <li>
                        <a onclick="listreceipe()"> <i class="menu-icon ti-email"></i>Receipes </a>
                    </li>
                    <li>
                      <a href="/additem/"> <i class="menu-icon ti-email"></i>Add Receipe </a>
                  </li>

                </ul>
            </div><!-- /.navbar-collapse -->
        </nav>
    </aside>
    <!-- /#left-panel -->
    <!-- Right Panel -->
    <div id="right-panel" class="right-panel">
        <!-- Header-->
        <header id="header" class="header">
            <div class="top-left">
                <div class="navbar-header">
                    <a class="navbar-brand" href="/"><img style="height:59.98px;width:53px" src="{%static 'Images/canteen.svg' %}" alt="Logo"></a>
                    <a class="navbar-brand hidden" href="./"><img src="#" alt="Logo"></a>
                    <a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>
                </div>
            </div>
            <div class="top-right">
                <div class="header-menu">
                    <div class="header-left">
                        <button class="search-trigger"><i class="fa fa-search"></i></button>
                        <div class="form-inline">
                            <form class="search-form">
                                <input class="form-control mr-sm-2" type="text" placeholder="Search ..." aria-label="Search">
                                <button class="search-close" type="submit"><i class="fa fa-close"></i></button>
                            </form>
                        </div>


                        
                    </div>

                    <div class="user-area dropdown float-right">
                        <a href="#" class="dropdown-toggle active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">{{request.user}}
                            <img class="user-avatar rounded-circle" src="{% static 'images/canteen.svg' %}">
                        </a>

                        <div class="user-menu dropdown-menu">
                            <a class="nav-link" href="/userdashboard/"><i class="fa fa- user"></i>My Profile</a>
                            <a class="nav-link" href="/logout"><i class="fa fa-power -off"></i>Logout</a>
                          
                        </div>
                    </div>

                 </div>
            </div>
        </header>
        <!-- /#header -->
        <!-- Content -->
        <div class="content">
            <!-- Animated -->
            <div class="animated fadeIn">
                <!-- Widgets  -->
                <div class="row">
                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-1">
                                        <i class="pe-7s-cash"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text">$<span id="srev"  class="count">12345</span></div>
                                            <div class="stat-heading">Revenue</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-2">
                                        <i class="pe-7s-cart"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">3435</span></div>
                                            <div class="stat-heading">Sales</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-3">
                                        <i class="pe-7s-browser"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span class="count">349</span></div>
                                            <div class="stat-heading">Templates</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <div class="stat-widget-five">
                                    <div class="stat-icon dib flat-color-4">
                                        <i class="pe-7s-users"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="text-left dib">
                                            <div class="stat-text"><span id ="usercnt" class="count">2986</span></div>
                                            <div class="stat-heading">Clients</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /Widgets -->
                <!--  Traffic  -->
                <div class="chrtcontainer">
                    <div class="charts"  id="abc"> </div>
                    <div class="charts"  id="barchart"></div>
                 </div>
                      
                
                <!-- Orders -->
                <div id="divpages"></div>
                

            </div>
            <!-- .animated -->
        </div>
        <!-- /.content -->
        <div class="clearfix"></div>
        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-inner bg-white">
                <div class="row">
                    <div class="col-sm-6">
                        Copyright &copy; 2024 CMS
                    </div>
                    <div class="col-sm-6 text-right">
                        Designed by <a href="Atebal Kant Singh">CMS</a>
                    </div>
                </div>
            </div>
        </footer>
        <!-- /.site-footer -->
    </div>
    <!-- /#right-panel -->

    <!-- Scripts -->
    <!--<script src="https://cdn.jsdelivr.net/npm/jquery@2.2.4/dist/jquery.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.4/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"></script> -->

    <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/js/bootstrap.min.js'></script>
    
 
    
    <!--<script src="{% static 'js/main.js' %}"></script>-->
    <script src="{% static 'js/datatables.min.js' %}"></script>
    
    <script src="{% static 'js/dataTables.bootstrap.min.js' %}"></script>
    <script src="{% static 'js/dataTables.buttons.min.js' %}"></script>
    <script src="{% static 'js/buttons.bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.12/js/dataTables.checkboxes.min.js"></script>
    <script src="{% static 'js/jszip.min.js' %}"></script>
    <script src="{% static 'js/vfs_fonts.js' %}"></script>
    <script src="{% static 'js/buttons.html5.min.js' %}"></script>
    <script src="{% static 'js/buttons.print.min.js' %}"></script>
    <script src="{% static 'js/buttons.colVis.min.js' %}"></script>
    <script src="{% static 'js/datatables-init.js' %}"></script>
    <script src="https://fastly.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    

      
   

    <!--Local Stuff-->
    <script>

$(document).ready(function(){
    debugger;
   var sales= getarrayfromstring("{{salesdate}}")
   var salesdates=removeescapecharchters(sales)


    var revenues= getarrayfromstring("{{salesrevenue}}")
    var  revenue=revenues.map(function(s){
                    return Number($.trim(s))
                    })

    var  srev=revenue.reduce(function(acc,s){
                return s+acc;
                },0);

     
    var allusers=getarrayfromstring("{{usrs}}")
    var formatedusername=removeescapecharchters(allusers)

   
    var recepenames=getarrayfromstring("{{recepname}}")
    var formatedrecepenames=removeescapecharchters(recepenames)

    var ordercountofuser=getarrayfromstring("{{ordercount}}")
    var  formattedordercountofuser=ordercountofuser.map(function(s){
                    return Number($.trim(s))
                    })

    ordercountrelatedusers=getarrayfromstring("{{orderuser}}")
    formateorderuser=removeescapecharchters(ordercountrelatedusers)

$('#srev')[0].innerText=srev;
$('#usercnt')[0].innerText='{{usercount}}'

loadlinechart(salesdates,revenue);
loadbarchart(salesdates,revenue);


function loadlinechart(salesdates,revenue)
{
    debugger;
    var dom = document.getElementById('abc');
    var myChart = echarts.init(dom, null, {
    renderer: 'canvas',
    useDirtyRect: false
        });
var app = {};
var option;
 
myChart.setOption(
    (option = {
      title: {
        text: 'Sales Revenue',
        left: '1%'
      },
      tooltip: {
        trigger: 'axis'
      },
      grid: {
        left: '5%',
        right: '15%',
        bottom: '10%'
      },
      xAxis: {
        data: salesdates
      },
      yAxis: {},
      toolbox: {
        right: 10,
        feature: {
          dataZoom: {
            yAxisIndex: 'none'
          },
          restore: {},
          saveAsImage: {}
        }
      },
      dataZoom: [
        {
          startValue: '2014-06-01'
        },
        {
          type: 'inside'
        }
      ],
      visualMap: {
        top: 50,
        right: 10,
        pieces: [
          {
            gt: 0,
            lte: 2150,
            color: '#93CE07'
          },
          {
            gt: 2150,
            lte: 2500,
            color: '#FBDB0F'
          },
          {
            gt: 2500,
            lte: 10750,
            color: '#FC7D02'
          },
          {
            gt: 10750,
            lte: 20000,
            color: '#FD0100'
          },
          {
            gt: 20000,
            lte: 30000,
            color: '#AA069F'
          },
          {
            gt: 40000,
            color: '#AC3B2A'
          }
        ],
        outOfRange: {
          color: '#999'
        }
      },
      series: {
        name: 'Sales Revenue',
        type: 'line',
        data: revenue,
        markLine: {
          silent: true,
          lineStyle: {
            color: '#333'
          },
          data: [
            {
              yAxis: 50000
            },
            {
              yAxis: 20000
            },
            {
              yAxis: 10000
            },
            {
              yAxis: 2000
            },
            {
              yAxis: 1000
            }
          ]
        }
      }
    })
  )
//});

if (option && typeof option === 'object') {
  myChart.setOption(option);
}

window.addEventListener('resize', myChart.resize);
}

function loadbarchart(salesdates,revenue)
{
    var dom = document.getElementById('barchart');
var myChart = echarts.init(dom, null, {
  renderer: 'canvas',
  useDirtyRect: false
});
var app = {};

var option;

option = {
  tooltip: {
    trigger: 'axis',
    axisPointer: {
      type: 'shadow'
    }
  },
  legend: {},
  grid: {
    left: '3%',
    right: '4%',
    bottom: '3%',
    containLabel: true
  },
  xAxis: [
    {
      type: 'category',
      data: salesdates
    }
  ],
  yAxis: [
    {
      type: 'value'
    }
  ],
  series: [
    {
      name: 'sales',
      type: 'bar',
      emphasis: {
        focus: 'series'
      },
      data: revenue
    },
    
  ]
};

if (option && typeof option === 'object') {
  myChart.setOption(option);
}

window.addEventListener('resize', myChart.resize);

}

});


function removeescapecharchters(str)
{
    formatestring=str.map(function(u){

      return $.trim(u.replace(/&#x27;/g,''))
});
return formatestring;
}

function getarrayfromstring(str)
{
    startingindex= str.indexOf("[")
    endingindex=str.indexOf("]")
    var arr=str.substr(startingindex+1,endingindex-1).split(",")
    return arr;
}


function displayuser()
    {
              debugger;
            $.ajax({
                url: '/users/',  // URL to the Django view
                type: 'GET',
                success: function (response) {
                    $('#divpages').html(response);
                      // Insert rendered HTML into div
                },
                error: function (error) {
                    console.log(error);
                }
            });
        
   
    
}  
  
function payment()
{
   
            $.ajax({
                url: '/payment/',  // URL to the Django view
                type: 'GET',
                success: function (response) {
                    $('#divpages').html(response); 
                    console.log('got user daat') // Insert rendered HTML into div
                },
                error: function (error) {
                    console.log(error);
                }
            });
        
}

function getroles()
{
   
            $.ajax({
                url: '/assignroles/',  // URL to the Django view
                type: 'GET',
                success: function (response) {
                    $('#divpages').html(response); 
                    console.log('got user daat') // Insert rendered HTML into div
                },
                error: function (error) {
                    console.log(error);
                }
            });
        
}

function foodmenu()
{
   
            $.ajax({
                url: '/menuitem/',  // URL to the Django view
                type: 'GET',
                success: function (response) {
                    $('#divpages').html(response); 
                    console.log('got user daat') // Insert rendered HTML into div
                },
                error: function (error) {
                    console.log(error);
                }
            });
        
}
  
function listreceipe()
{
   
            $.ajax({
                url: '/listreceipe/',  // URL to the Django view
                type: 'GET',
                success: function (response) {
                  debugger;
                    $('#divpages').html(response); 
                    console.log('got receipe data') // Insert rendered HTML into div
                },
                error: function (error) {
                    console.log(error);
                }
            });
        
}
  

function createwhatstoday()
   {
      
    $.ajax({
                url: '/whatstoday/',  // URL to the Django view
                type: 'GET',
                success: function (response) {
                  debugger;
                    $('#divpages').html(response); 
                    console.log('got receipe data') // Insert rendered HTML into div
                },
                error: function (error) {
                    console.log(error);
                }
            });
   }
   
   function whatstodaylist()
   {
      
    $.ajax({
                url: '/todayslist/',  // URL to the Django view
                type: 'GET',
                success: function (response) {
                  debugger;
                    $('#divpages').html(response); 
                    console.log('got receipe data') // Insert rendered HTML into div
                },
                error: function (error) {
                    console.log(error);
                }
            });
   } 

     function getreceipedetails() {
            
      var table = $('#bootstrap-data-table-receipe').DataTable();          

     $('#bootstrap-data-table-receipe tbody').on('click', 'td', function () {

      
                            debugger;
            var cellIndex = table.cell(this).index();
            var cellData = table.cell(this).data();
            var rowIndex = table.row($(this).closest('tr')).index();
            var rowData = table.row(rowIndex).data();
            var id=table.row(rowIndex).data().DT_RowId
           
            if(cellIndex.column==3){
                
    
            debugger;
            $.ajax({
                type: 'GET',
                url: '/getreceipedetails/',  // URL to the Django view
                data: { 'id': id 
                        },
                success: function (response) {
                    debugger;
                    console.log("entered")
                    $('#divpopedit').html(response);
                    
                    $("#editr").modal('show');
                    // $('#divpages').html(response); 


                },
                error: function (error) {
                    console.log(error);
                }
            });
          }
        else if(cellIndex.column==4)
        {

        var csrfToken = '{{ csrf_token }}'; // Obtain CSRF token from Django template
        $.ajax({
            type: 'POST',
            url: '/deletereceipe/',
            data: {
                'id': id,
                
                'csrfmiddlewaretoken': csrfToken
            },
            success: function (response) {
                $('#divpages').html(response);
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
            }
        });

    }
        
          }); 

        }

    
function deletereceipe(id) {
        var csrfToken = '{{ csrf_token }}'; // Obtain CSRF token from Django template
        $.ajax({
            type: 'POST',
            url: '/deletereceipe/',
            data: {
                'id': id,
                
                'csrfmiddlewaretoken': csrfToken
            },
            success: function (response) {
                $('#divpages').html(response);
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
            }
        });

    }



    
    </script>
</body>

</html>