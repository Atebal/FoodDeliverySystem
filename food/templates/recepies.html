{% block start %}

{% load static %}


<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang=""> <!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1">
   
</head>

<body>

    <div class="content">
        <div class="animated fadeIn">
            <div class="row">

                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <strong class="card-title">Data Table</strong>
                        </div>
                        <div class="card-body">
                            <form id="reeipieslist" method="post" enctype="multipart/form-data">
                                {% csrf_token %}
                                <table id="bootstrap-data-table" class="table table-striped table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Receipe</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for item in items%}
                                        <tr>
                                            <td>{{item.itemName}}</td>
                                            <td>{{item.price}}</td>
                                            <td>{{item.totalquantities}}</td>
                                            <td id="{{item.id}}"><button   class="btn btn-success"><i class="bi bi-pencil"></i></button>
                                                                <button     class="btn btn-danger"><i class="bi bi-trash3"></i></button>
                                                               
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </form>
                        </div>
                    </div>
                </div>


            </div>
        </div><!-- .animated -->
    </div><!-- .content -->


    <div class="clearfix"></div>

    </div><!-- /#right-panel -->

    <!-- Right Panel -->

    <!-- Scripts -->
   
   

<script type="text/javascript">

var buttonClass;
$('#bootstrap-data-table .btn').click(function() {
    debugger;
     buttonClass = $(this).attr('class');
        
    });


$('#bootstrap-data-table tbody').on('click', 'td', function () {
    debugger;
     var id = $(this).attr('id');   
          
           if(buttonClass==="btn btn-success"){
            getreceipedetails(id);
           }

           if(buttonClass==="btn btn-danger"){
            deleteuser(username);
            }
     
        });


function getreceipedetails(id)
{
   
            $.ajax({
                url: '/getreceipedetails/',  // URL to the Django view
                type: 'GET',
                date:{'id':id},
                success: function (response) {
                    $('#divpages').html(response); 
                    
                },
                error: function (error) {
                    console.log(error);
                }
            });
        
}

            function editreceipe(id) {
                debugger;
                var table = $('#bootstrap-data-table').DataTable();
                var csrfToken = '{{ csrf_token }}'; // Obtain CSRF token from Django template
                debugger;
                var username;

                $('#bootstrap-data-table tbody').on('click', 'tr', function (e) {
                    debugger;
                    e.preventDefault();
                    username = table.row(this).data()[0];
                     // Assuming username is the first column
                   
                    isEmployee=$('#empchk_'+id.substr(2))[0].checked;
                    isAdmin=$('#adminchk_'+id.substr(2))[0].checked;
                    $.ajax({
                        type: 'POST',
                        url: '/assignroles/',
                        data: {
                            'username': username,
                            'isEmployee':isEmployee,
                            'isAdmin':isAdmin,
                            'csrfmiddlewaretoken': csrfToken
                        },
                        success: function (response) {
                            $('#divpages').html(response);
                        },
                        error: function (xhr, status, error) {
                            console.error(xhr.responseText);
                        }
                    });
                });
            }
        
            function removeredeipe(id) {
                debugger;
                var table = $('#bootstrap-data-table').DataTable();
                var csrfToken = '{{ csrf_token }}'; // Obtain CSRF token from Django template
                debugger;
                var username;

                $('#bootstrap-data-table tbody').on('click', 'tr', function (e) {
                    debugger;
                    e.preventDefault();
                    username = table.row(this).data()[0];
                     // Assuming username is the first column
                   
                    isEmployee=$('#empchk_'+id.substr(2))[0].checked;
                    isAdmin=$('#adminchk_'+id.substr(2))[0].checked;
                    $.ajax({
                        type: 'POST',
                        url: '/removeroles/',
                        data: {
                            'username': username,
                            'isEmployee':isEmployee,
                            'isAdmin':isAdmin,
                            'csrfmiddlewaretoken': csrfToken
                        },
                        success: function (response) {
                            $('#divpages').html(response);
                        },
                        error: function (xhr, status, error) {
                            console.error(xhr.responseText);
                        }
                    });
                });
            }

      

    </script>


</body>

</html>

{% endblock %}